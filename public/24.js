(window.webpackJsonp=window.webpackJsonp||[]).push([[24],{OAC2:function(t,e,a){"use strict";a.r(e);var n=a("o0o1"),o=a.n(n);function r(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var a=Object.prototype.toString.call(t).slice(8,-1);"Object"===a&&t.constructor&&(a=t.constructor.name);if("Map"===a||"Set"===a)return Array.from(t);if("Arguments"===a||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var a=0,n=new Array(e);a<e;a++)n[a]=t[a];return n}function l(t,e,a,n,o,r,i){try{var l=t[r](i),s=l.value}catch(t){return void a(t)}l.done?e(s):Promise.resolve(s).then(n,o)}function s(t){return function(){var e=this,a=arguments;return new Promise((function(n,o){var r=t.apply(e,a);function i(t){l(r,n,o,i,s,"next",t)}function s(t){l(r,n,o,i,s,"throw",t)}i(void 0)}))}}var c={props:{id:{required:!0},name:{type:String},qr:{type:String}},components:{"app-converted-units":function(){return a.e(2).then(a.bind(null,"ervk"))},"app-qrcode":function(){return a.e(3).then(a.bind(null,"17CV"))},"app-menu":function(){return a.e(1).then(a.bind(null,"qLbV"))},"crud-dialog":function(){return a.e(6).then(a.bind(null,"g7UR"))},"datatable-search":function(){return a.e(0).then(a.bind(null,"GPzU"))},"info-alert":function(){return a.e(4).then(a.bind(null,"x4NR"))},"main-layout":function(){return a.e(5).then(a.bind(null,"PU6b"))}},data:function(){return{autocomplete:{items:[],loading:!1,name:null,selected:null},datatable:{headers:[{text:"Code",align:"start",value:"code"},{text:"Raw Item Name",align:"start",value:"name"},{text:"Quantity",value:"units_needed",align:"end"},{text:"Actions",value:"actions",align:"center",sortable:!1}],items:[],loading:!1,search:null},dialog:{category_name:null,converted_label:null,converted_value:1,loading:!1,raw_name:null,show:!1,title:"N/A",units:[],menu_label:null},form:{product_id:0,quantity:1,raw_id:0},itemIndex:-1,units:[]}},mounted:function(){this.form.product_id=this.id,this.loadItems()},methods:{loadItems:function(){var t=this;this.datatable.loading=this.autocomplete.loading=this.dialog.loading=!0,axios.post("/products/assembled/view",{id:this.id}).then((function(e){t.datatable.items=e.data.product,t.units=e.data.convert,t.datatable.loading=t.dialog.loading=!1})).then((function(){return axios.post("/products/raw/view")})).then((function(e){t.autocomplete.items=e.data.raw,t.autocomplete.loading=!1}))},onCreate:function(){this.autocomplete.selected&&(this.dialog.title="Add",this.form.quantity=1,this.dialog.category_name=this.autocomplete.selected.category.name,this.dialog.raw_name=this.autocomplete.selected.name,this.form.raw_id=this.autocomplete.selected.id,this.itemIndex=-1,this.dialog.converted_label=this.autocomplete.selected.base.name,this.prepareUnits(this.autocomplete.selected.base_id),this.dialog.show=!0)},onEdit:function(t){this.dialog.title="Update",this.form.quantity=t.pivot.quantity,this.dialog.category_name=t.category.name,this.dialog.raw_name=t.name,this.form.raw_id=t.id,this.itemIndex=this.datatable.items.indexOf(t),this.dialog.converted_label=t.base.name,this.prepareUnits(t.base_id),this.dialog.show=!0},prepareUnits:function(t){var e=this;return s(o.a.mark((function a(){var n;return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return n=r(e.units),a.next=3,n.filter((function(e){if(e.base_id==t)return e}));case 3:e.dialog.units=a.sent,e.dialog.units.length>0&&(e.dialog.menu_label=e.dialog.units[0].name,e.converted_value=e.dialog.units[0].value);case 5:case"end":return a.stop()}}),a)})))()},onStore:function(){var t=this;return s(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.post("/products/assembled/attach",t.form).then((function(e){console.log(e.data.product),t.$store.commit("showSnackbar",{color:!0,text:"".concat(t.dialog.raw_name," added.")}),t.datatable.items=e.data.product})).catch((function(e){e.response&&(console.log(e.response),t.$store.commit("errorSnackbar"))}));case 2:t.datatable.loading=!1;case 3:case"end":return e.stop()}}),e)})))()},onUpdate:function(){var t=this;return s(o.a.mark((function e(){return o.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.post("/products/assembled/update",t.form).then((function(e){t.$store.commit("showSnackbar",{color:!0,text:"".concat(t.dialog.raw_name," updated.")}),t.datatable.items=e.data.product})).catch((function(e){e.response&&(console.log(e.response),t.$store.commit("errorSnackbar"))}));case 2:t.datatable.loading=!1;case 3:case"end":return e.stop()}}),e)})))()},onDelete:function(t){var e=this;return s(o.a.mark((function a(){return o.a.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!confirm("Are you sure you want to delete ".concat(t.name))){a.next=7;break}return e.form.raw_id=t.id,e.datatable.loading=!0,e.dialog.raw_name=t.name,a.next=6,axios.post("/products/assembled/detach",e.form).then((function(t){e.$store.commit("showSnackbar",{color:!0,text:"".concat(e.dialog.raw_name," removed.")}),e.datatable.items=t.data.product})).catch((function(t){t.response&&(console.log(t.response),e.$store.commit("errorSnackbar"))}));case 6:e.datatable.loading=!1;case 7:case"end":return a.stop()}}),a)})))()},onMenuSelect:function(t){this.dialog.menu_label=t.name,this.dialog.converted_value=t.value},submit:function(){this.form.quantity>=0?(this.dialog.show=!1,this.datatable.loading=!0,this.form.quantity=this.dialog.converted_value*this.form.quantity,-1==this.itemIndex?this.onStore():this.onUpdate()):this.$store.commit("showSnackbar",{color:!1,text:"Quantity field is required."})}}},u=a("KHd+"),d=Object(u.a)(c,(function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("main-layout",{scopedSlots:t._u([{key:"info-alert",fn:function(){return[a("info-alert",{attrs:{text:"Tip: Search and select raw item, then click the add button."}})]},proxy:!0},{key:"card-title",fn:function(){return[a("v-btn",{attrs:{text:""}},[a("v-icon",{attrs:{left:""},on:{click:function(e){return t.$emit("onBack")}}},[t._v("mdi-arrow-left")])],1),t._v("\n    "+t._s(t.name)+"\n    "),a("crud-dialog",{attrs:{title:t.dialog.title},on:{submit:t.submit},model:{value:t.dialog.show,callback:function(e){t.$set(t.dialog,"show",e)},expression:"dialog.show"}},[a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{sm:"12"}},[a("v-text-field",{attrs:{disabled:"",label:"Category Name",value:t.dialog.category_name}})],1)],1),t._v(" "),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{sm:"12"}},[a("v-text-field",{attrs:{disabled:"",label:"Raw Item Name",value:t.dialog.raw_name}})],1)],1),t._v(" "),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{sm:"12"}},[a("v-text-field",{attrs:{label:"Quantity",autofocus:"",type:"number",clearable:""},on:{"click:clear":function(e){t.form.quantity=""},keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},scopedSlots:t._u([{key:"append-outer",fn:function(){return[a("app-menu",{attrs:{menu:t.dialog.units,label:t.dialog.menu_label},on:{onSelect:t.onMenuSelect}})]},proxy:!0}]),model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1)],1),t._v(" "),a("v-row",{attrs:{"no-gutters":""}},[a("v-col",{attrs:{sm:"12"}},[a("app-converted-units",{attrs:{quantity:t.form.quantity,convertValue:t.dialog.converted_value,label:t.dialog.converted_label}})],1)],1)],1)]},proxy:!0},{key:"card-text",fn:function(){return[a("v-row",[a("v-col",{attrs:{cols:"3",md:"2"}},[a("app-qrcode",{staticClass:"text-center",attrs:{value:t.qr,level:"H"}})],1),t._v(" "),a("v-col",{attrs:{cols:"6",md:"8"}},[a("v-autocomplete",{attrs:{"search-input":t.autocomplete.name,loading:t.autocomplete.loading,items:t.autocomplete.items,"item-text":"name","item-value":"id",placeholder:"Search raw items...",label:"Raw Items",hint:"Click the add button after selecting your preferred raw item.","persistent-hint":"","return-object":"",clearable:"","open-on-clear":"",color:"pink accent-1"},on:{keydown:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.onCreate(e)},"update:searchInput":function(e){return t.$set(t.autocomplete,"name",e)},"update:search-input":function(e){return t.$set(t.autocomplete,"name",e)}},model:{value:t.autocomplete.selected,callback:function(e){t.$set(t.autocomplete,"selected",e)},expression:"autocomplete.selected"}})],1),t._v(" "),a("v-col",{attrs:{cols:"3",md:"2"}},[a("v-btn",{staticClass:"ml-3",attrs:{text:"",outlined:"",color:"green darken-4",loading:t.dialog.loading,disabled:!t.autocomplete.selected},on:{click:t.onCreate}},[t._v("\n          Add\n        ")])],1)],1)]},proxy:!0},{key:"datatable",fn:function(){return[a("v-data-table",{attrs:{headers:t.datatable.headers,items:t.datatable.items,loading:t.datatable.loading,search:t.datatable.search},scopedSlots:t._u([{key:"top",fn:function(){return[a("datatable-search",{model:{value:t.datatable.search,callback:function(e){t.$set(t.datatable,"search",e)},expression:"datatable.search"}})]},proxy:!0},{key:"item.actions",fn:function(e){var n=e.item;return[a("v-btn",{attrs:{text:"",color:"blue darken-4"},on:{click:function(e){return e.stopPropagation(),t.onEdit(n)}}},[t._v("\n          Update\n        ")]),t._v(" "),a("v-btn",{attrs:{text:"",color:"red darken-4"},on:{click:function(e){return e.stopPropagation(),t.onDelete(n)}}},[t._v("\n          Delete\n        ")])]}}])})]},proxy:!0}])})}),[],!1,null,null,null);e.default=d.exports}}]);