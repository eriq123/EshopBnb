(window.webpackJsonp=window.webpackJsonp||[]).push([[27],{zx9A:function(t,e,n){"use strict";n.r(e);var o=n("o0o1"),a=n.n(o);function r(t){return function(t){if(Array.isArray(t))return i(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||function(t,e){if(!t)return;if("string"==typeof t)return i(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);"Object"===n&&t.constructor&&(n=t.constructor.name);if("Map"===n||"Set"===n)return Array.from(t);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return i(t,e)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,o=new Array(e);n<e;n++)o[n]=t[n];return o}function l(t,e,n,o,a,r,i){try{var l=t[r](i),s=l.value}catch(t){return void n(t)}l.done?e(s):Promise.resolve(s).then(o,a)}function s(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var r=t.apply(e,n);function i(t){l(r,o,a,i,s,"next",t)}function s(t){l(r,o,a,i,s,"throw",t)}i(void 0)}))}}var c={props:{id:{required:!0},name:{type:String}},components:{"app-converted-units":function(){return n.e(2).then(n.bind(null,"ervk"))},"app-qrcode":function(){return n.e(3).then(n.bind(null,"17CV"))},"app-menu":function(){return n.e(1).then(n.bind(null,"qLbV"))},"crud-dialog":function(){return n.e(26).then(n.bind(null,"vyn4"))},"datatable-search":function(){return n.e(0).then(n.bind(null,"GPzU"))},"main-layout":function(){return n.e(5).then(n.bind(null,"PU6b"))}},data:function(){return{datatable:{headers:[{text:"Code",align:"start",value:"code"},{text:"Raw Item Name",align:"start",value:"name"},{text:"Quantity",value:"units_needed",align:"end"},{text:"Reorder Point",value:"custom_reorder_point",align:"end"},{text:"Actions",value:"actions",align:"center",sortable:!1}],items:[],loading:!1,search:null},dialog:{show:!1,title:"N/A",qr_code:null,converts:[],conversion:{quantity:{label:null,value:null},reorder_point:{label:null,value:null}},unit_label:null},form:{base_id:0,category_id:0,name:null,quantity:1,reorder_point:1},itemIndex:-1,units:[],converts:[]}},mounted:function(){this.form.category_id=this.id,this.loadItems()},methods:{loadItems:function(){var t=this;return s(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return t.datatable.loading=!0,e.next=3,axios.post("/products/raw/view",{id:t.id}).then((function(e){t.datatable.items=e.data.raw,t.units=e.data.base,t.converts=e.data.convert})).catch((function(e){e.response&&(console.log(e.response),t.$store.commit("errorSnackbar"))}));case 3:t.datatable.loading=!1;case 4:case"end":return e.stop()}}),e)})))()},onCreate:function(){this.dialog.title="Add",this.itemIndex=-1,this.dialog.qr_code=null,this.form.id=null,this.formData(),this.units.length>0&&(this.form.base_id=this.units[0].id,this.dialog.conversion.reorder_point.label=this.dialog.conversion.quantity.label=this.dialog.unit_label=this.units[0].name),this.prepareFilteredConverts(),this.dialog.show=!0},onEdit:function(t){this.dialog.title="Update",this.itemIndex=this.datatable.items.indexOf(t),this.dialog.qr_code=t.qr_code,this.formData(t.name,t.base_id,t.quantity,t.reorder_point),this.form.id=t.id,this.form.base_id=t.base_id,this.dialog.conversion.reorder_point.label=this.dialog.conversion.quantity.label=this.dialog.unit_label=t.base.name,this.prepareFilteredConverts(),this.dialog.show=!0},formData:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.form.name=t,this.form.base_id=e,this.form.quantity=n,this.form.reorder_point=o},prepareFilteredConverts:function(){var t=this;return s(a.a.mark((function e(){var n;return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=r(t.converts),e.next=3,n.filter((function(e){if(e.base_id==t.form.base_id)return e}));case 3:t.dialog.converts=e.sent,console.log(t.converts),console.log(t.dialog.converts),t.dialog.converts.length>0&&(t.dialog.conversion.reorder_point.value=t.dialog.conversion.quantity.value=t.dialog.converts[0].value);case 7:case"end":return e.stop()}}),e)})))()},onStoreAndUpdate:function(){var t=this;return s(a.a.mark((function e(){return a.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,axios.post(-1==t.itemIndex?"/products/raw/add":"/products/raw/update",t.form).then((function(e){var n=e.data.raw;-1==t.itemIndex?(t.$store.commit("showSnackbar",{color:!0,text:"".concat(n.name," added.")}),t.datatable.items.unshift(n)):(t.$store.commit("showSnackbar",{color:!0,text:"".concat(n.name," has been updated.")}),Object.assign(t.datatable.items[t.itemIndex],n))})).catch((function(e){e.response&&(console.log(e.response),t.$store.commit("errorSnackbar"))}));case 2:t.datatable.loading=!1;case 3:case"end":return e.stop()}}),e)})))()},onDelete:function(t){var e=this;return s(a.a.mark((function n(){return a.a.wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(!confirm("Are you sure you want to delete ".concat(t.name))){n.next=5;break}return e.datatable.loading=!0,n.next=4,axios.post("/products/raw/delete",{id:t.id}).then((function(n){e.$store.commit("showSnackbar",{color:!0,text:"".concat(n.data.raw.name," deleted.")}),e.itemIndex=e.datatable.items.indexOf(t),e.datatable.items.splice(e.itemIndex,1)})).catch((function(t){t.response&&(console.log(t.response),e.$store.commit("errorSnackbar"))}));case 4:e.datatable.loading=!1;case 5:case"end":return n.stop()}}),n)})))()},submit:function(){this.form.quantity>=0||null!==this.form.name||this.form.reorder_point>=0||0!==this.form.base_id?(this.dialog.show=!1,this.datatable.loading=!0,this.form.quantity=this.dialog.conversion.quantity.value*this.form.quantity,this.form.reorder_point=this.dialog.conversion.reorder_point.value*this.form.reorder_point,this.onStoreAndUpdate()):this.$store.commit("showSnackbar",{color:!1,text:"Please check all fields and try again."})},onSelectBase:function(t){this.dialog.conversion.reorder_point.label=this.dialog.conversion.quantity.label=this.dialog.unit_label=t.name,this.form.base_id=t.id,this.prepareFilteredConverts()},onSelectQuantity:function(t){this.dialog.conversion.quantity.label=t.name,this.dialog.conversion.quantity.value=t.value},onSelectReorderPoint:function(t){this.dialog.conversion.reorder_point.label=t.name,this.dialog.conversion.reorder_point.value=t.value},unitslink:function(){window.location.href="/units/"}}},u=n("KHd+"),d=Object(u.a)(c,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("main-layout",{scopedSlots:t._u([{key:"card-title",fn:function(){return[n("v-btn",{attrs:{text:""}},[n("v-icon",{attrs:{left:""},on:{click:function(e){return t.$emit("onBack")}}},[t._v("mdi-arrow-left")])],1),t._v("\n    "+t._s(t.name)+"\n    "),n("v-btn",{staticClass:"ml-3",attrs:{text:"",outlined:"",color:"green darken-4"},on:{click:t.onCreate}},[t._v("\n      Create\n    ")]),t._v(" "),n("crud-dialog",{attrs:{title:t.dialog.title},on:{submit:t.submit},model:{value:t.dialog.show,callback:function(e){t.$set(t.dialog,"show",e)},expression:"dialog.show"}},[n("v-row",{attrs:{"no-gutters":""}},[n("v-col",{attrs:{sm:"12"}},[n("v-text-field",{attrs:{label:"Category Name",value:t.name,disabled:""}})],1)],1),t._v(" "),n("v-row",{attrs:{"no-gutters":""}},[n("v-col",{attrs:{sm:"12"}},[n("v-text-field",{attrs:{label:"Raw Item Name","hide-details":""},model:{value:t.form.name,callback:function(e){t.$set(t.form,"name",e)},expression:"form.name"}})],1)],1),t._v(" "),n("v-row",[n("v-col",{attrs:{cols:"12"}},[n("v-tooltip",{attrs:{left:""},scopedSlots:t._u([{key:"activator",fn:function(e){var o=e.on,a=e.attrs;return[n("v-btn",t._g(t._b({attrs:{text:""},on:{click:t.unitslink}},"v-btn",a,!1),o),[t._v("\n                Unit of Measurement:\n              ")])]}}])},[t._v(" "),n("span",[t._v(" Update ")])]),t._v(" "),n("app-menu",{attrs:{menu:t.units,label:t.dialog.unit_label},on:{onSelect:t.onSelectBase}})],1)],1),t._v(" "),n("v-row",{attrs:{"no-gutters":""}},[n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{type:"number",label:"Quantity"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},scopedSlots:t._u([{key:"append-outer",fn:function(){return[n("app-menu",{attrs:{menu:t.dialog.converts,label:t.dialog.conversion.quantity.label},on:{onSelect:t.onSelectQuantity}})]},proxy:!0}]),model:{value:t.form.quantity,callback:function(e){t.$set(t.form,"quantity",e)},expression:"form.quantity"}})],1),t._v(" "),n("v-col",{attrs:{cols:"6"}},[n("app-converted-units",{attrs:{quantity:t.form.quantity,convertValue:t.dialog.conversion.quantity.value,label:t.dialog.unit_label}})],1)],1),t._v(" "),n("v-row",{staticClass:"mb-3",attrs:{"no-gutters":""}},[n("v-col",{attrs:{cols:"6"}},[n("v-text-field",{attrs:{type:"number",label:"Reorder point"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.submit(e)}},scopedSlots:t._u([{key:"append-outer",fn:function(){return[n("app-menu",{attrs:{menu:t.dialog.converts,label:t.dialog.conversion.reorder_point.label},on:{onSelect:t.onSelectReorderPoint}})]},proxy:!0}]),model:{value:t.form.reorder_point,callback:function(e){t.$set(t.form,"reorder_point",e)},expression:"form.reorder_point"}})],1),t._v(" "),n("v-col",{attrs:{cols:"6"}},[n("app-converted-units",{attrs:{quantity:t.form.reorder_point,convertValue:t.dialog.conversion.reorder_point.value,label:t.dialog.unit_label}})],1)],1),t._v(" "),t.dialog.qr_code?n("v-row",{attrs:{"no-gutters":""}},[n("v-col",{staticClass:"py-0",attrs:{align:"center"}},[n("app-qrcode",{staticClass:"center-align",attrs:{value:t.dialog.qr_code,level:"H"}})],1)],1):t._e()],1)]},proxy:!0},{key:"datatable",fn:function(){return[n("v-data-table",{attrs:{headers:t.datatable.headers,items:t.datatable.items,loading:t.datatable.loading,search:t.datatable.search},scopedSlots:t._u([{key:"top",fn:function(){return[n("datatable-search",{model:{value:t.datatable.search,callback:function(e){t.$set(t.datatable,"search",e)},expression:"datatable.search"}})]},proxy:!0},{key:"item.actions",fn:function(e){var o=e.item;return[n("v-btn",{attrs:{text:"",color:"blue darken-4"},on:{click:function(e){return e.stopPropagation(),t.onEdit(o)}}},[t._v("\n          Update\n        ")]),t._v(" "),n("v-btn",{attrs:{text:"",color:"red darken-4"}},[t._v(" Delete ")])]}}])})]},proxy:!0}])})}),[],!1,null,null,null);e.default=d.exports}}]);